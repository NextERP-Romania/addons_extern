<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
    <!--  set paper format for invoice our a4 --> 
	<function name="write" model="ir.actions.report">            
	  <function name="search" model="ir.actions.report">                
	    <value eval="[('model', '=', 'account.move')]"   />            
	   </function>
	    <value eval="{'paperformat_id': ref('cbs_solutions_customization.paperformat_A4_cbs')}" />
	</function>

    <!-- modify the invoice to have issuer | invoice | client -->
	<template id="partner_display_invoice" >
				<div  style="display: inline-block">
		    			<div class="mt16">
		    				<strong>
		    					<t t-if="part==o.company_id.partner_id">Issuer:</t>
		    					<t t-else="">Client:</t>
		    				</strong>
		    				<span t-esc="part.name"></span>
		    			</div> 
			            <div class="mt16">
			                <strong>Nr. Reg. Com:</strong><span t-field="part.nrc" />
			            </div>
 	                    <div class="mt16">
	                        <strong><t t-if="part.country_id.vat_label" t-esc="part.country_id.vat_label" id="inv_tax_id_label"/>
	                        <t t-else="">Tax ID</t>: </strong><span t-field="part.vat"/></div>

			            <div class="mt16" style="display: inline-block">
			                <strong>Address:</strong><span t-field="part.street" />
			                <t t-if="part.street2"  ><span t-field="part.street2"/></t>
			                <t t-if="part.city_id" ><span t-field="part.city_id.name" /></t>
			                <t t-if="not part.city_id" >
			                	<t t-if="part.city"><span t-field="part.city" /></t>
			                </t>
			            </div>
			            <div class="mt16">
			                <strong>State:</strong><span t-field="part.state_id.name" />
			                <span t-field="part.country_id.name" />
			            </div>
 
			            <div t-foreach="part.commercial_partner_id.bank_ids"
			                t-as="bank" id="partner_bank"  >
			                <t t-if="bank.print_report">
 			                    <div t-if="bank.bank_name">
			                        <strong>Bank:</strong>
			                        <span t-field="bank.bank_name" />
			                    </div>
			                    <div t-if="bank.acc_number">
			                        <strong>IBAN <span t-field="bank.currency_id" />:</strong>
			                        <span t-field="bank.sanitized_acc_number" />
			                    </div>
			                </t>
			            </div>
                        <div class="mt16" t-if="part.ref" name="customer_code">
                            <strong>Customer Code:</strong>
                            <span  t-field="part.ref"/>
                        </div>

			     </div>
	</template>
    
    <template id="issuer_and_client" inherit_id="account.report_invoice_document">

	   	<t t-set="address" position="replace"/>

    	<xpath expr="//div[@class='page']/h2" position="replace"/>
    	<xpath expr="//div[@id='informations']" position="replace">
          <div class="row col-auto">
            <div class="col-4 p-0 b-0">
                        <t t-set="type" t-value="'Issuer:'"/>
                        <t t-set="part" t-value="o.company_id.partner_id"/>
                        <t t-call="cbs_solutions_customization.partner_display_invoice"/>
            </div>
            <div class="col-4 px-3">
                        <h4 style="text-align: center;"><strong>
                            <span t-if="o.move_type == 'out_invoice' and o.state == 'posted'">Invoice</span>
                            <span t-if="o.move_type == 'out_invoice' and o.state == 'draft'">Draft Invoice</span>
                            <span t-if="o.move_type == 'out_invoice' and o.state == 'cancel'">Cancelled Invoice</span>
                            <span t-if="o.move_type == 'out_refund'">Credit Note</span>
                            <span t-if="o.move_type == 'in_refund'">Vendor Credit Note</span>
                            <span t-if="o.move_type == 'in_invoice'">Vendor Bill</span>
                            </strong>
                        </h4>
                        <div t-if="o.name != '/'" class="border border-dark b-0 p-1" >
                        <div class="mt16" t-if="o.name != '/'" >
                            <strong>Invoice nr:</strong><span class="float-right" t-field="o.name"/>
                        </div>
                        <div class="mt16 " t-if="o.invoice_date" name="invoice_date">
                            <strong>Invoice Date:</strong>
                            <span class="float-right" t-field="o.invoice_date"/>
                        </div>
                        <div class="mt16" t-if="o.invoice_date_due and o.move_type == 'out_invoice' and o.state == 'posted'" name="due_date">
                            <strong>Due Date:</strong>
                            <span class="float-right" t-field="o.invoice_date_due"/>
                        </div>
                        <div class="mt16" t-if="o.invoice_origin" name="origin">
                            <strong>Source:</strong>
                            <span  t-field="o.invoice_origin"/>
                            <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s' %
                ('Code128', o.invoice_origin, 260, 30)" style="width:100%;"/>
                        </div>
                        <div class="mt16" t-if="o.ref" name="reference">
                            <strong>Reference:</strong>
                            <p  t-field="o.ref"/>
                        </div>
                        </div>
                    </div>
            <div class="col-4 p-0 b-0">
                        <t t-set="type" t-value="'Client:'"/>
                        <t t-set="part" t-value="o.partner_id"/>
                        <t t-call="cbs_solutions_customization.partner_display_invoice"/>
            </div>
          </div>    
          <br/>
</xpath>

<!-- at credit note put qty with -         -->

<span t-field="line.quantity" position="before">
    <t t-if="o.move_type == 'out_refund'">-</t>
</span>
<span t-field="line.price_subtotal" position="before">
    <t t-if="o.move_type == 'out_refund'">-</t>
</span>
<span t-esc="current_subtotal" position="before">
    <t t-if="o.move_type == 'out_refund'">-</t>
</span>    
    

<span t-field="o.amount_untaxed" position="before">
    <t t-if="o.move_type == 'out_refund'">-</t>
</span>

<span t-esc="amount_by_group[3]" position="before">
    <t t-if="o.move_type == 'out_refund'">-</t>
</span>    
    
<span  t-field="o.amount_total" position="before">
    <t t-if="o.move_type == 'out_refund'">-</t>
</span>    


<!-- if the invoice is canceled will not show lines in print -->
<t t-foreach="lines" position="before">
    <t t-if="o.move_type == 'out_invoice' and o.state == 'cancel'"><t t-set="lines" t-value="[]"/></t>
</t>

<span t-field="o.amount_untaxed" position="replace">
    <t t-if="lines==[]">0</t> 
    <t t-if="lines!=[]"><span t-field="o.amount_untaxed"/></t>
</span>
<span  t-field="o.amount_total" position="replace">
    <t t-if="lines==[]">0</t> 
    <t t-if="lines!=[]"><span class="text-nowrap" t-field="o.amount_total"/></t>
</span>


<t t-foreach="o.amount_by_group" position="before">
    <t t-if="o.move_type == 'out_invoice' and o.state == 'cancel'"><t t-set="taxes" t-value="[]"/></t>
    <t t-else=""><t t-set="taxes" t-value="o.amount_by_group"/></t>
</t>
<t t-foreach="o.amount_by_group" position="attributes">
    <attribute name="t-foreach">taxes</attribute>
</t>

<!-- put also the payment 
        <xpath expr="//div[@id='qrcode']" position="after">
                <t t-if="o.cache_receipt_id">
                    <br/> <br/>
                    <t t-set="o" t-value="o.cache_receipt_id"/>
                    <t  t-call="cbs_solutions_customization.one_payment_receipt"/>
                </t>
        </xpath>-->
<!--
  	    <xpath expr="//div[@t-if='o.currency_id != o.company_currency_id and o.currency_rate']" position="replace"/>

		<div class="row" style="margin-top: 20px;" />
        <div t-if="o.currency_id != o.company_currency_id and o.currency_rate"
               class="col" >
               Currency rate: 1
               <span t-esc="o.currency_id.symbol" />
               =
               <span t-esc="round(o.currency_rate, 4)" />
               <span t-esc="o.company_id.currency_id.symbol" />
	    </div>
 -->    	

    
	  </template>

    </data>
</odoo>
